# Level Up Fitness - Apache Configuration
# Security and URL rewriting rules

# Enable mod_rewrite
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Set RewriteBase to the directory where the app is installed
    RewriteBase /level-up-fitness/
    
    # Prevent direct access to sensitive directories (but allow PHP file execution)
    RewriteRule ^(config|includes|sql)(/|$) - [F,L]
    
    # Prevent direct access to certain files
    RewriteRule ^(\.env|composer\.json|README\.md|SETUP\.md)$ - [F,L]
</IfModule>

# Security headers
<IfModule mod_headers.c>
    # Prevent clickjacking attacks
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Enable XSS protection in older browsers
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Prevent caching of sensitive pages
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript
</IfModule>

# Enable GZIP compression
<IfModule mod_gzip.c>
    mod_gzip_on Yes
    mod_gzip_dechunk Yes
    mod_gzip_item_include file \.(html?|txt|css|js|json|xml|svg)$
    mod_gzip_item_include handler ^cgi-script$
    mod_gzip_item_include mime ^text/.*
    mod_gzip_item_include mime ^application/x-javascript.*
    mod_gzip_item_exclude mime ^image/.*
    mod_gzip_level 6
</IfModule>

# Deny access to directories without a default file
<IfModule mod_dir.c>
    DirectoryIndex index.php
</IfModule>

# Disable directory listing
Options -Indexes

# Prevent access to hidden files and directories
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect sensitive files from being viewed
<FilesMatch "\.env|\.git|\.gitignore">
    Order allow,deny
    Deny from all
</FilesMatch>

# Allow access to static files (images, css, js)
<FilesMatch "\.(jpg|jpeg|png|gif|svg|css|js|woff|woff2|ttf|otf|eot)$">
    Header set Cache-Control "max-age=31536000, public"
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </IfModule>
</FilesMatch>

# PHP Security Settings (if PHP is installed)
<IfModule mod_php7.c>
    php_value display_errors 0
    php_value log_errors 1
    php_value error_log /var/log/php-errors.log
    php_value post_max_size 50M
    php_value upload_max_filesize 50M
    php_value max_execution_time 300
</IfModule>

# Force HTTPS (uncomment when SSL is installed)
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>

# Deny direct access to this .htaccess file
<Files .htaccess>
    Order Allow,Deny
    Deny from all
</Files>
